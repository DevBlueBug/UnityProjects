//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.18408
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using SimpleJSON;
namespace Data
{
	public class JsonWrapper
	{
		public static Dictionary<Data.Piece.KType, string> dicTypeString = 
		dicTypeString = new Dictionary<Data.Piece.KType, string> (){
			//{EditorPiece.KType.World,"A"},
			{Data.Piece.KType.Empty,"A"},
			{Data.Piece.KType.Ground,"K"},
			{Data.Piece.KType.Block_Hard,"B"},
			{Data.Piece.KType.Block_Soft,"C"},
			{Data.Piece.KType.Decoration,"D"},
			{Data.Piece.KType.Door,"E"},
			{Data.Piece.KType.Edge,"F"},
			{Data.Piece.KType.EnemyFlying,"G"},
			{Data.Piece.KType.EnemyFoot,"H"},
			{Data.Piece.KType.EnemyTower,"I"},
			{Data.Piece.KType.EnemyTurret,"J"},
			{Data.Piece.KType.Item,"L"},
			{Data.Piece.KType.Player,"M"},
			{Data.Piece.KType.TrapFoot,"N"},
			{Data.Piece.KType.TrapGravity,"O"},
			{Data.Piece.KType.TrapTower,"P"}
		};
		public static Dictionary<string, Data.Piece.KType> dicStringType;
		static JsonWrapper ()
		{
			dicStringType = new Dictionary<string, Piece.KType> ();
			foreach (var e in dicTypeString)
				dicStringType.Add (e.Value, e.Key);

		}
		public static void helperUnwrap(JSONArray arr,List<Piece> pieces){
			for(int i = 0; i < arr.Count;i++){
				var element = arr[i];
				var piece = new Piece(
					dicStringType[ element["Type"]],element["X"].AsInt,element["Y"].AsInt);
				pieces.Add(piece);
			}
		}
		public static bool UnWrap(string content,out Board board){
			board = new Board ();
			if (content == null) return false;
			try{
				var node = JSON.Parse (content);
				
				for (int i = 0; i < 4; i++) {
					board.doors[i] = node["door"][i].AsBool;
				}
				var arrWorld = node ["piecesWorld"].AsArray;
				var arrUnits = node ["piecesUnits"].AsArray;
				helperUnwrap ( arrWorld, board.piecesWorld);
				helperUnwrap ( arrUnits, board.piecesUnits);
				return true;
			}
			catch{
				return false;
			}
		}
		
		public static JSONNode Wrap(Board data){
			var node = JSON.Parse ("{}");
			JSONArray 
				listPiecesWorld = new JSONArray (),
				listPiecesUnits = new JSONArray ();
			node ["door"] [-1].AsBool = data.doors [0];
			node ["door"] [-1].AsBool = data.doors [1];
			node ["door"] [-1].AsBool = data.doors [2];
			node ["door"] [-1].AsBool = data.doors [3];
			
			foreach (var pieceWorld in data.piecesWorld) {
				listPiecesWorld.Add( Wrap(pieceWorld));	
			}
			foreach (var pieceUnit in data.piecesUnits) {
				listPiecesUnits.Add(Wrap(pieceUnit));
			}
			node ["piecesWorld"] = listPiecesWorld;
			node ["piecesUnits"] = listPiecesUnits;
			//Debug.Log ("ToJson EditorBoard_Data " + node.ToString ());
			return node;
		}
		public static JSONNode Wrap(Piece piece){
			if (piece == null) return null;
			var node = JSON.Parse ("{}");
			node["X"].AsInt = piece.X;
			node["Y"].AsInt = piece.Y;
			node["Type"] = dicTypeString[piece.meType];
			return node;
		}
	}
}

